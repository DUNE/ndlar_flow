classname: WaveformSum
path: module0_flow.reco.light.wvfm_sum
requires:
  - 'light/events'
  - 'light/deconv'
  - 'light/deconv/alignment'
params:
  # input
  wvfm_dset_name: 'light/deconv'

  # output
  swvfm_dset_name: 'light/swvfm'

  # configuration parameters
  gain:
    # by default, don't include channel in waveform sum
    default: 0.0000e+00
    # each gain value provided here is based on a calibration to the observed
    # signal on the charge readout, using cosmic events with no activity within
    # 2cm of any light detector. Units are keV/tick / ADC
    #0: { 2: 1.4525e-02, 3: 1.3895e-02, 4: 1.4376e-02, 5: 1.2182e-02, 6: 1.3779e-02, 7: 5.0751e-03, 9: 1.3345e-02, 10: 1.4942e-02, 11: 1.7046e-02, 12: 1.7402e-02, 14: 2.7270e-02, 18: 1.9810e-02, 19: 2.0980e-02, 20: 1.9596e-02, 21: 1.8332e-02, 22: 2.1615e-02, 23: 2.0927e-02, 25: 1.2823e-02, 26: 1.4079e-02, 27: 1.6632e-02, 28: 1.7882e-02, 29: 1.7390e-02, 30: 1.9697e-02, 35: 0.0000e+00, 36: 0.0000e+00, 39: 0.0000e+00, 41: 1.2692e-02, 42: 1.2613e-02, 43: 1.7041e-02, 44: 1.7847e-02, 45: 1.4114e-02, 46: 1.5241e-02, 50: 1.4195e-02, 51: 1.3905e-02, 52: 1.3748e-02, 53: 1.5610e-02, 54: 1.3821e-02, 55: 1.3739e-02, 57: 2.3834e-02, 58: 2.4991e-02, 59: 2.2988e-02, 60: 2.6654e-02, 61: 1.5890e-02, 62: 1.9259e-02, }
    #1: { 2: 1.8860e-02, 3: 1.9424e-02, 4: 1.8047e-02, 5: 1.7522e-02, 6: 1.5116e-02, 7: 1.4150e-02, 9: 1.6605e-02, 10: 1.7856e-02, 11: 1.9807e-02, 12: 1.9066e-02, 13: 1.7053e-02, 14: 1.5104e-02, 18: 1.3558e-02, 19: 1.3792e-02, 20: 1.4216e-02, 21: 1.3315e-02, 22: 1.3428e-02, 23: 1.3759e-02, 25: 1.5107e-02, 26: 1.5866e-02, 27: 2.0814e-02, 28: 2.1102e-02, 29: 1.8527e-02, 30: 1.8993e-02, 35: 1.7351e-02, 36: 1.8616e-02, 37: 1.4856e-02, 38: 1.5792e-02, 39: 1.4641e-02, 41: 1.2887e-02, 42: 1.2124e-02, 43: 1.7385e-02, 44: 1.6613e-02, 45: 1.2566e-02, 46: 1.2990e-02, 50: 1.5488e-02, 51: 1.3824e-02, 52: 1.3927e-02, 53: 1.5037e-02, 54: 1.4777e-02, 55: 1.6400e-02, 57: 1.3862e-02, 58: 1.4645e-02, 59: 1.8616e-02, 60: 1.9612e-02, 61: 1.5219e-02, 62: 1.7967e-02, }
    
    # JINR gain calibration using LEDs. Units are PE/tick / ADC
    1 : {2 : 0.00017191110133127956, 3 : 0.0001761754425527117, 4 : 0.00018319849923789422, 5 : 0.00018440930012982414, 6 : 0.00018187638226050518, 7 : 0.00017276647501105705, 9 : 0.0018423534960499937, 10 : 0.0018985419198055892, 11 : 0.0018419191323824117, 12 : 0.001834566161794059, 13 : 0.0019141247090530443, 14 : 0.001795977011494253, 18 : 0.00017462002682163612, 19 : 0.0001813276082163166, 20 : 0.00016716593559430834, 21 : 0.00017007728311744857, 22 : 0.00017198679141441938, 23 : 0.00017083971134922372, 25 : 0.001758383974791807, 26 : 0.0017589778228076101, 27 : 0.0019614612101431085, 28 : 0.0019373837569745813, 29 : 0.0019247351564424735, 30 : 0.0019015455762443718, 35 : 0.00016686245194361384, 36 : 0.00018683486787038144, 37 : 0.00017798154687322017, 38 : 0.00017481539494294026, 39 : 0.00017871440009150177, 41 : 0.001475866628884481, 42 : 0.0014721123045034858, 43 : 0.0014424852289512554, 44 : 0.0014772619835492105, 45 : 0.0014643861293345832, 46 : 0.001474473907709729, 50 : 0.00016456029489204845, 51 : 0.00016345852076577046, 52 : 0.00016537891617273497, 53 : 0.00015805179041068177, 54 : 0.00016186677716771987, 55 : 0.00016686245194361384, 57 : 0.0016541393182299387, 58 : 0.0016643587558585428, 59 : 0.0016650682011935208, 60 : 0.0016837284482758622, 61 : 0.001694134229643283, 62 : 0.0017037400501581073, }
    0: {2 : 0.00018023993540200716, 3 : 0.00018247109657830202, 4 : 0.00017972164711295148, 5 : 0.00017703376387944708, 6 : 0.0001798043728423475, 9 : 0.001560939060939061, 10 : 0.001637497380004192, 11 : 0.0017230921923246578, 12 : 0.0016700513039760582, 14 : 0.0016154880066170387, 18 : 0.0002223249857712009, 19 : 0.00023735379006531977, 20 : 0.00020202999741401602, 21 : 0.00019499563209784103, 22 : 0.00023994164619164617, 23 : 0.0002326533650982728, 25 : 0.0015733561574866578, 26 : 0.0016048685291700903, 27 : 0.0016093315480482024, 28 : 0.0016489024905023215, 29 : 0.001644390654599032, 30 : 0.001607179592676404, 41 : 0.0016116554925219185, 42 : 0.0016318537859007834, 43 : 0.0016325357851844113, 44 : 0.0016645360605092147, 45 : 0.0015631252501000401, 46 : 0.0016629416773094932, 50 : 0.0002136021872863978, 51 : 0.00020618896806545261, 52 : 0.00019383451184716536, 53 : 0.00020265888456549936, 54 : 0.00019937476075028708, 55 : 0.00019347449232293213, 57 : 0.0019894321364909598, 58 : 0.0020268517317421197, 59 : 0.0016837284482758622, 60 : 0.0016012502562000412, 61 : 0.0016291314774267544, 62 : 0.0019446172993154947, }

#  gain_mc: # original lut
#    default: 0.0
#    0: { 2: 1.5950e-02, 3: 1.5071e-02, 4: 1.4178e-02, 5: 1.2917e-02, 6: 1.2806e-02, 7: 1.2362e-02, 9: 1.4313e-02, 10: 1.4595e-02, 11: 1.4937e-02, 12: 1.4845e-02, 14: 3.0669e-02, 18: 1.5330e-02, 19: 1.5922e-02, 20: 1.6061e-02, 21: 1.5734e-02, 22: 1.5345e-02, 23: 1.5360e-02, 25: 1.5116e-02, 26: 1.5165e-02, 27: 1.5746e-02, 28: 1.5852e-02, 29: 1.5956e-02, 30: 1.6050e-02, 41: 1.4144e-02, 42: 1.3850e-02, 43: 1.4863e-02, 44: 1.4889e-02, 45: 1.5238e-02, 46: 1.5181e-02, 50: 1.5652e-02, 51: 1.4882e-02, 52: 1.5295e-02, 53: 1.5260e-02, 54: 1.4681e-02, 55: 1.4843e-02, 57: 1.5433e-02, 58: 1.5554e-02, 59: 1.6498e-02, 60: 1.6721e-02, 61: 1.5918e-02, 62: 1.6018e-02 }
#    1: { 2: 1.5608e-02, 3: 1.5785e-02, 4: 1.4301e-02, 5: 1.4023e-02, 6: 1.2798e-02, 7: 1.2584e-02, 9: 1.3987e-02, 10: 1.3849e-02, 11: 1.4803e-02, 12: 1.5067e-02, 13: 1.4566e-02, 14: 1.4596e-02, 18: 1.4644e-02, 19: 1.4457e-02, 20: 1.5095e-02, 21: 1.4984e-02, 22: 1.5318e-02, 23: 1.5154e-02, 25: 1.4624e-02, 26: 1.4674e-02, 27: 1.5968e-02, 28: 1.5750e-02, 29: 1.6515e-02, 30: 1.6598e-02, 35: 1.9537e-02, 36: 1.8261e-02, 37: 1.7565e-02, 38: 1.7053e-02, 39: 1.6861e-02, 41: 1.4535e-02, 42: 1.4877e-02, 43: 1.4843e-02, 44: 1.4934e-02, 45: 1.5216e-02, 46: 1.5194e-02, 50: 1.5199e-02, 51: 1.4201e-02, 52: 1.3649e-02, 53: 1.3716e-02, 54: 1.4290e-02, 55: 1.4657e-02, 57: 1.5819e-02, 58: 1.5742e-02, 59: 1.5659e-02, 60: 1.5548e-02, 61: 1.5070e-02, 62: 1.5153e-02 }

  gain_mc: # modified lut
    default: 0.0
    #0: { 2: 1.4228e-02, 3: 1.4042e-02, 4: 1.3264e-02, 5: 1.2289e-02, 6: 1.1901e-02, 7: 1.1519e-02, 9: 1.2776e-02, 10: 1.2782e-02, 11: 1.2532e-02, 12: 1.2536e-02, 14: 2.4997e-02, 18: 1.2637e-02, 19: 1.2448e-02, 20: 1.2698e-02, 21: 1.2974e-02, 22: 1.2958e-02, 23: 1.2952e-02, 25: 1.2435e-02, 26: 1.2648e-02, 27: 1.2235e-02, 28: 1.2186e-02, 29: 1.2656e-02, 30: 1.2622e-02, 41: 1.2026e-02, 42: 1.1984e-02, 43: 1.2301e-02, 44: 1.2328e-02, 45: 1.2443e-02, 46: 1.2413e-02, 50: 1.2699e-02, 51: 1.2468e-02, 52: 1.2627e-02, 53: 1.2759e-02, 54: 1.2538e-02, 55: 1.2392e-02, 57: 1.2504e-02, 58: 1.2475e-02, 59: 1.2523e-02, 60: 1.2578e-02, 61: 1.2331e-02, 62: 1.2355e-02 }
    #1: { 2: 1.4332e-02, 3: 1.3965e-02, 4: 1.3081e-02, 5: 1.1980e-02, 6: 1.1765e-02, 7: 1.1701e-02, 9: 1.2947e-02, 10: 1.3002e-02, 11: 1.3111e-02, 12: 1.3076e-02, 13: 1.2854e-02, 14: 1.2696e-02, 18: 1.2885e-02, 19: 1.2805e-02, 20: 1.2891e-02, 21: 1.2968e-02, 22: 1.2596e-02, 23: 1.2592e-02, 25: 1.2156e-02, 26: 1.2125e-02, 27: 1.2048e-02, 28: 1.2107e-02, 29: 1.2072e-02, 30: 1.2166e-02, 35: 1.7386e-02, 36: 1.6205e-02, 37: 1.5523e-02, 38: 1.5159e-02, 39: 1.5111e-02, 41: 1.3799e-02, 42: 1.3888e-02, 43: 1.3522e-02, 44: 1.3458e-02, 45: 1.3100e-02, 46: 1.3170e-02, 50: 1.2626e-02, 51: 1.2230e-02, 52: 1.2225e-02, 53: 1.2219e-02, 54: 1.1941e-02, 55: 1.1924e-02, 57: 1.2432e-02, 58: 1.2452e-02, 59: 1.2183e-02, 60: 1.2145e-02, 61: 1.2230e-02, 62: 1.2221e-02 }

    # JINR calibration values (copied from above)
    1 : {2 : 0.00017191110133127956, 3 : 0.0001761754425527117, 4 : 0.00018319849923789422, 5 : 0.00018440930012982414, 6 : 0.00018187638226050518, 7 : 0.00017276647501105705,
         9 : 0.0018423534960499937, 10 : 0.0018985419198055892, 11 : 0.0018419191323824117, 12 : 0.001834566161794059, 13 : 0.0019141247090530443, 14 : 0.001795977011494253,
         18 : 0.00017462002682163612, 19 : 0.0001813276082163166, 20 : 0.00016716593559430834, 21 : 0.00017007728311744857, 22 : 0.00017198679141441938, 23 : 0.00017083971134922372,
         25 : 0.001758383974791807, 26 : 0.0017589778228076101, 27 : 0.0019614612101431085, 28 : 0.0019373837569745813, 29 : 0.0019247351564424735, 30 : 0.0019015455762443718,
         35 : 0.00016686245194361384, 36 : 0.00018683486787038144, 37 : 0.00017798154687322017, 38 : 0.00017481539494294026, 39 : 0.00017871440009150177, 41 : 0.001475866628884481,
         42 : 0.0014721123045034858, 43 : 0.0014424852289512554, 44 : 0.0014772619835492105, 45 : 0.0014643861293345832, 46 : 0.001474473907709729,
         50 : 0.00016456029489204845, 51 : 0.00016345852076577046, 52 : 0.00016537891617273497, 53 : 0.00015805179041068177, 54 : 0.00016186677716771987, 55 : 0.00016686245194361384,
         57 : 0.0016541393182299387, 58 : 0.0016643587558585428, 59 : 0.0016650682011935208, 60 : 0.0016837284482758622, 61 : 0.001694134229643283, 62 : 0.0017037400501581073, }
         
    0 : {2 : 0.00018023993540200716, 3 : 0.00018247109657830202, 4 : 0.00017972164711295148, 5 : 0.00017703376387944708, 6 : 0.0001798043728423475,
         9 : 0.001560939060939061, 10 : 0.001637497380004192, 11 : 0.0017230921923246578, 12 : 0.0016700513039760582, 14 : 0.0016154880066170387,
         18 : 0.0002223249857712009, 19 : 0.00023735379006531977, 20 : 0.00020202999741401602, 21 : 0.00019499563209784103, 22 : 0.00023994164619164617, 23 : 0.0002326533650982728,
         25 : 0.0015733561574866578, 26 : 0.0016048685291700903, 27 : 0.0016093315480482024, 28 : 0.0016489024905023215, 29 : 0.001644390654599032, 30 : 0.001607179592676404,
         41 : 0.0016116554925219185, 42 : 0.0016318537859007834, 43 : 0.0016325357851844113, 44 : 0.0016645360605092147, 45 : 0.0015631252501000401, 46 : 0.0016629416773094932,
         50 : 0.0002136021872863978, 51 : 0.00020618896806545261, 52 : 0.00019383451184716536, 53 : 0.00020265888456549936, 54 : 0.00019937476075028708, 55 : 0.00019347449232293213,
         57 : 0.0019894321364909598, 58 : 0.0020268517317421197, 59 : 0.0016837284482758622, 60 : 0.0016012502562000412, 61 : 0.0016291314774267544, 62 : 0.0019446172993154947, }